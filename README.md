# CCSDS MO XML to AsyncAPI YAML
- Convert CCSDS MO XML specification files into AsyncAPI YAML document.
- XML files are located in the [xml-ccsds-mo-prototypes](/xml-ccsds-mo-prototypes/) directory.
- Generated AsyncAPI docs are hosted [here](https://tanagraspace.github.io/ccsds-mo-to-asyncapi/).

## Generate Everything
```shell
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pytest gencode
pytest genyaml
./01_generate_code.sh
./02_generate_yaml.sh
./03_generate_docs.sh
```

Or do it all in one go:
```shell
./generate_all.sh
```

## Technical Notes
- Executing `03_generate_docs.sh` requires `sudo` privileges as it involves changing ownership of files generated by Docker.
- The generated code will be located in the _mo-asyncapi/src_ folder. This code is used to generate the AsyncAPI YAML definitions.

## Dynamic Replies
AsyncAPI allows two patterns to enable dynamic responses: **Dynamic Reply Address** and **Dynamic Response Channel**. Review [this tutorial](https://www.asyncapi.com/docs/tutorials/getting-started/request-reply) for an introduction on **Static Reply Address** and **Dynamic Reply Address**.

|                             | **Static Reply Address**                          | **Dynamic Reply Address**             | **Dynamic Response Channel**                  |
|-----------------------------|---------------------------------------------------|---------------------------------------|-----------------------------------------------|
| **Flexibility**             | Fixed, predefined reply address                   | Client specifies `replyTo` in headers | Client specifies `clientId` in headers        |
| **Server Behavior**         | Publishes responses to a predefined channel       | Reads `replyTo` from request headers  | Reads `clientId` from request headers         |
| **Client Response Channel** | Static, defined in configuration                  | Temporary, created at runtime         | Predefined, tied to client Id                 |
| **Use Case**                | Simplified communication for predictable systems  | Simple, flexible for ad-hoc responses | Isolated, useful for high client concurrency  |


The YAML Generators in this project supports generating YAML API docs for **Static Reply Address** and **Dynamic Reply Address** via the `is_dynamic_reply_address` property flag in the [AbstractYamlGenerator](./genyaml/src/generators/abstract_yaml_generator.py) abstract class:
- **True**: Enables the Dynamic Reply Address pattern, allowing clients to specify a replyTo header.
- **False**: Enables the Static Reply Address pattern, where responses are sent to a predefined channel.

The YAML generators, pre-generated YAML files, and the demo app included in this the repository all implement **Dynamic Reply Address**. Sample YAMLs can be found [here](./SAMPLEYAML.md).

## Scope
- The MO MAL XML definitions that are processed to generate code are listed in [this bash script](/01_generate_code.sh), they are:
  - MAL v003
  - COM v001
  - Mission and Control v002
  - Software Management v001
  - File Management v001
- The MO MAL XML definitions that are processed to generate YAML AsyncAPI service definitions are listed in [this bash script](/02_generate_yaml.sh), they are:
  - Mission and Control v002
  - Software Management v001
  - File Management v001
- The following MAL interaction types are supported: [PubSub](/genyaml/src/generators/yaml_generator_pubsub.py), [Request](/genyaml/src/generators/yaml_generator_request.py), [Submit](/genyaml/src/generators/yaml_generator_submit.py), and [Progress](/genyaml/src/generators/yaml_generator_progress.py)
- The Invoke interaction types is **NOT** currently supported.

## Interaction Type YAML Generators
- Each interaction type has its own AsyncAPY YAML generator implementation, [here](/genyaml/src/generators/).
- The interaction type YAML generators to use are included in a list of generator instances in [this module's main function](/genyaml/src/generate_yaml.py).
- An interaction can be skipped by populating an `ignores` dictionary hardcoded in [this module's main function](/genyaml/src/generate_yaml.py).