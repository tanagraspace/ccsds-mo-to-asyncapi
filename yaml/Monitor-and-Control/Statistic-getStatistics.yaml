asyncapi: 3.0.0
info:
  title: Statistic Service getStatistics API
  version: 1.0.0
  description: This API allows clients to interact with the getStatistics iteraction of the Statistic Service.
defaultContentType: application/json
servers:
  production:
    host: 'localhost:{port}'
    protocol: mqtt
    description: MQTT server for the getStatistics interaction.
    variables:
      port:
        enum:
          - '8883'
          - '8884'
        default: '8883'
    bindings:
      mqtt:
        clientId: guest
        cleanSession: false
        keepAlive: 0
        lastWill:
          topic: /will
          qos: 0
          message: Guest gone offline.
          retain: false
channels:
  Send_Statistic_getStatistics:
    address: Send_Statistic_getStatistics
    messages:
      Statistic.getStatistics_Send.message:
        $ref: '#/components/messages/Statistic_getStatistics_Send'
    description: >
      Send a **Statistic_getStatistics_Send** message in this channel to receive a
      **Statistic_getStatistics_Receive** message over the **Receive_Statistic_getStatistics** channel.
  Receive_Statistic_getStatistics:
    address: Receive_Statistic_getStatistics
    messages:
      Statistic.getStatistics_Receive.message:
        $ref: '#/components/messages/Statistic_getStatistics_Receive'
    description: >
      Use this channel to receive Statistic getStatistics responses as **Statistic_getStatistics_Receive**
      messages.
  Error_Statistic_getStatistics:
    address: Error_Statistic_getStatistics
    messages:
      Statistic.getStatistics_Error.message:
        $ref: '#/components/messages/Statistic_getStatistics_Error'
    description: >
      Use this channel to receive Statistic getStatistics errors as **Statistic_getStatistics_ReceiveErrors**
      messages.
operations:
  Statistic_getStatistics_Send:
    action: send
    channel:
      $ref: '#/channels/Send_Statistic_getStatistics'
    messages:
      - $ref: '#/channels/Send_Statistic_getStatistics/messages/Statistic.getStatistics_Send.message'
  Statistic_getStatistics_Receive:
    action: receive
    channel:
      $ref: '#/channels/Receive_Statistic_getStatistics'
    messages:
      - $ref: '#/channels/Receive_Statistic_getStatistics/messages/Statistic.getStatistics_Receive.message'
  Statistic_getStatistics_Error:
    action: receive
    channel:
      $ref: '#/channels/Error_Statistic_getStatistics'
    messages:
      - $ref: '#/channels/Error_Statistic_getStatistics/messages/Statistic.getStatistics_Error.message'
components:
  schemas:
    Statistic_getStatistics_Send:
      type: object
      properties:
        transactionId:
          type: string
          description: A unique identifier to map the response to the request.
        funcObjInstIds:
          type: integer
          description: |
            The funcObjInstIds field shall include a list of StatisticFunction object instance identifiers to match.
            The funcObjInstIds field shall support the wildcard value of '0' and will match all functions of the provider.
            The wildcard value should be checked for first, if found no other checks of supplied object instance identifiers shall be made.
          format: int64
        isGroup:
          type: boolean
        paramObjInstIds:
          $ref: '#/components/schemas/com/ObjectKey'
          description: |
            If the isGroup field is TRUE then the paramObjInstIds field shall contain GroupIdentity object instance identifiers, otherwise the field shall contain ParameterIdentity object instance identifiers.
            If the isGroup field is TRUE, the requested Group, or the Group objects referenced by that Group, must contain ParameterIdentity objects otherwise an INVALID error shall be returned.
            The ParameterIdentity objects referenced, either directly or indirectly via groups, by the paramObjInstIds field shall be the parameters to match.
            The paramObjInstIds field shall support the wildcard value of '0' and matches all parameters of the provider matched to the functions given in the funcObjInstIds field.
            The wildcard value should be checked for first, if found no other checks of supplied object instance identifiers shall be made.
            If a requested function, group or parameters is unknown then an UNKNOWN error shall be returned.
            The sets of matched StatisticFunction objects and ParameterIdentity objects shall be matched to the set of existing StatisticLink objects to determine which StatisticLink objects to report on.
    Statistic_getStatistics_Receive:
      type: object
      properties:
        transactionId:
          type: string
          description: A unique identifier to map the response to the request.
        evaluations:
          $ref: '#/components/schemas/mc/statistic/StatisticEvaluationReport'
          description: |
            The response shall contain a list of matching statistics evaluation values.
            The operation shall trigger an evaluation of the statistical functions matched and return the new evaluation values.
            If it is not possible to return an evaluation value for a matched evaluation (for example not enough samples available) then no entry for that evaluation shall be included.
            The evaluation shall not trigger a report via the monitorStatistics operation.
            Requesting an evaluation shall ignore the samplingInterval, reportingInterval, and collectionInterval fields and requests an immediate evaluation of the statistic.
            Requesting an evaluation during a periodic evaluation shall not influence the periodic evaluation (e.g. it does not reset the samplingInterval, reportingInterval, and collectionInterval timers or the current periodic collection value).
    Statistic_getStatistics_Error:
      type: object
      properties:
        transactionId:
          type: string
          description: A unique identifier to map the response to the request.
        area:
          type: string
          description: The area in which the error applies.
          enum:
            - MAL
            - COM
        name:
          type: string
          description: A code representing the error.
          enum:
            - INVALID
            - UNKNOWN
        extraInformation:
          type: array
          items:
            type: integer
            format: uint32
            description: A list of the indexes of the erroneous values from the originating list supplied or request list.
    com:
      ObjectKey:
        properties:
          domain:
            description: The domain of the object instance.
            items:
              type: string
            type: array
          instId:
            description: The unique identifier of the object instance. Must not be '0' for
              values as this is the wildcard.
            format: int64
            type: integer
        type: object
    mc:
      statistic:
        StatisticEvaluationReport:
          properties:
            linkId:
              description: The statistic link object instance identifier.
              format: int64
              type: integer
            value:
              $ref: '#/components/schemas/mc/statistic/StatisticValue'
              description: The statistical evaluation value.
          type: object
        StatisticValue:
          properties:
            endTime:
              description: Time the statistic calculations ended. This value can be NULL if
                the time can be derived by other means, e.g., other times in a set of StatisticValue
                structures.
              format: uint64
              type: number
            paramDefInstId:
              description: The object instance identifier of the ParameterDefinition object
                used for the parameter.
              format: int64
              type: integer
            sampleCount:
              description: Holds the number of samples that contributed to the statistic value.
                For calculated values such as 'mean average' this holds the number of samples
                that were used to calculate the value, for non-calculated values such as 'min'
                then it is the number of samples that were in the set evaluated.
              format: uint32
              type: integer
            startTime:
              description: Time the statistic calculations started. This value can be NULL if
                the start time can be derived by other means, e.g., other start times in a set
                of StatisticValue structures.
              format: uint64
              type: number
            value:
              description: Value of the statistic.
              type: string
            valueTime:
              description: Time the statistic value was reached. The time is only applicable
                for particular statistic values such as min or max. Shall be NULL if not applicable
                for cases such as 'mean average'.
              format: uint64
              type: number
          type: object
  messages:
    Statistic_getStatistics_Send:
      description: Statistic getStatistics request submission
      payload:
        $ref: '#/components/schemas/Statistic_getStatistics_Send'
    Statistic_getStatistics_Receive:
      description: Statistic getStatistics update response
      payload:
        $ref: '#/components/schemas/Statistic_getStatistics_Receive'
    Statistic_getStatistics_Error:
      description: Statistic getStatistics error response
      payload:
        $ref: '#/components/schemas/Statistic_getStatistics_Error'
