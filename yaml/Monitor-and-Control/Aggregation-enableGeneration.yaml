asyncapi: 3.0.0
info:
  title: Aggregation Service enableGeneration API
  version: 1.0.0
  description: This API allows clients to interact with the enableGeneration iteraction of the Aggregation Service.
defaultContentType: application/json
servers:
  production:
    host: 'localhost:{port}'
    protocol: mqtt
    description: MQTT server for the enableGeneration interaction.
    variables:
      port:
        enum:
          - '8883'
          - '8884'
        default: '8883'
    bindings:
      mqtt:
        clientId: guest
        cleanSession: false
        keepAlive: 0
        lastWill:
          topic: /will
          qos: 0
          message: Guest gone offline.
          retain: false
channels:
  Send_Aggregation_enableGeneration:
    address: Send_Aggregation_enableGeneration
    messages:
      Aggregation.enableGeneration_Send.message:
        $ref: '#/components/messages/Aggregation_enableGeneration_Send'
    description: >
      Send a **Aggregation_enableGeneration_Send** message in this channel to receive a
      **Aggregation_enableGeneration_Receive** message over the **Receive_Aggregation_enableGeneration** channel.
  Receive_Aggregation_enableGeneration:
    address: Receive_Aggregation_enableGeneration
    messages:
      Aggregation.enableGeneration_Receive.message:
        $ref: '#/components/messages/Aggregation_enableGeneration_Receive'
    description: >
      Use this channel to receive Aggregation enableGeneration responses as **Aggregation_enableGeneration_Receive**
      messages.
  Error_Aggregation_enableGeneration:
    address: Error_Aggregation_enableGeneration
    messages:
      Aggregation.enableGeneration_Error.message:
        $ref: '#/components/messages/Aggregation_enableGeneration_Error'
    description: >
      Use this channel to receive Aggregation enableGeneration errors as **Aggregation_enableGeneration_ReceiveErrors**
      messages.
operations:
  Aggregation_enableGeneration_Send:
    action: send
    channel:
      $ref: '#/channels/Send_Aggregation_enableGeneration'
    messages:
      - $ref: '#/channels/Send_Aggregation_enableGeneration/messages/Aggregation.enableGeneration_Send.message'
  Aggregation_enableGeneration_Receive:
    action: receive
    channel:
      $ref: '#/channels/Receive_Aggregation_enableGeneration'
    messages:
      - $ref: '#/channels/Receive_Aggregation_enableGeneration/messages/Aggregation.enableGeneration_Receive.message'
  Aggregation_enableGeneration_Error:
    action: receive
    channel:
      $ref: '#/channels/Error_Aggregation_enableGeneration'
    messages:
      - $ref: '#/channels/Error_Aggregation_enableGeneration/messages/Aggregation.enableGeneration_Error.message'
components:
  schemas:
    Aggregation_enableGeneration_Send:
      type: object
      properties:
        transactionId:
          type: string
          description: A unique identifier to map the response to the request.
        isGroupIds:
          type: boolean
          description: |
            If the isGroupIds field is TRUE then the enableInstances field shall contain GroupIdentity object instance identifiers, otherwise the field contains AggregationIdentity object instance identifiers.
            The AggregationIdentity objects referenced, either directly or indirectly via groups, by the enableInstances field shall be the AggregationIdentity objects to match.
            The id of the enableInstances field shall support the wildcard value of '0' and matches all AggregationIdentity objects of the provider.
            The service provider shall check for the wildcard value in the list of object instance identifiers in the enableInstances field first and if found no other checks of supplied object instance identifiers shall be made.
            If the enableInstances field contains a value of TRUE then reports of matching AggregationIdentity objects shall be generated, a value of FALSE requests that reports will not be generated.
            No error shall be raised if the enableInstances Boolean value supplied is the same as the current generationEnabled field of the definition for a matched AggregationIdentity object i.e. enabling an already enabled aggregation will not result in an error.
            If a requested AggregationIdentity or GroupIdentity object is unknown then an UNKNOWN error shall be returned.
            If a requested Group, or the Group objects referenced by that Group, does not contain AggregationIdentity objects then an INVALID error shall be returned.
            If an error is raised then no modifications shall be made as a result of this operation call.
            The provider shall create and store a new AggregationDefinition object in the COM archive if the generationEnabled field is changed.
            If a new AggregationDefinition object is created then that new object shall be the current AggregationDefinition used for the specific AggregationIdentity.
        enableInstances:
          $ref: '#/components/schemas/com/InstanceBooleanPair'
          description: |
            If the generation of reports is being enabled, and the aggregation is defined as being periodic, then the provider shall generate a report immediately and start the report interval from that report.
    Aggregation_enableGeneration_Receive:
      type: object
      properties:
        transactionId:
          type: string
          description: A unique identifier to map the response to the request.
        newObjInstIds:
          type: integer
          description: |
            The response shall contain the list of object instance identifiers for the new AggregationDefinition objects.
          format: int64
    Aggregation_enableGeneration_Error:
      type: object
      properties:
        transactionId:
          type: string
          description: A unique identifier to map the response to the request.
        area:
          type: string
          description: The area in which the error applies.
          enum:
            - MAL
            - COM
        name:
          type: string
          description: A code representing the error.
          enum:
            - UNKNOWN
            - INVALID
        extraInformation:
          type: array
          items:
            type: integer
            format: uint32
            description: A list of the indexes of the erroneous values from the originating list supplied or request list.
    com:
      InstanceBooleanPair:
        properties:
          id:
            description: The object instance identifier.
            format: int64
            type: integer
          value:
            description: An associated Boolean value.
            type: boolean
        type: object
  messages:
    Aggregation_enableGeneration_Send:
      description: Aggregation enableGeneration request submission
      payload:
        $ref: '#/components/schemas/Aggregation_enableGeneration_Send'
    Aggregation_enableGeneration_Receive:
      description: Aggregation enableGeneration update response
      payload:
        $ref: '#/components/schemas/Aggregation_enableGeneration_Receive'
    Aggregation_enableGeneration_Error:
      description: Aggregation enableGeneration error response
      payload:
        $ref: '#/components/schemas/Aggregation_enableGeneration_Error'
